#!/bin/bash

set -e

usage_error() {
  error_msg=${1}
  [[ ! -z ${error_msg}  ]] && echo "wsctl: ${error_msg}"
  echo  "Usage: wsctl {COMMAND}"
  echo  "Commands:"
  echo  "  start   start the analytics workspace services"
  echo  "  stop    stop the analytics workspace services"
  echo  "  status  show runtime status of anlaytics workspace services"
  exit 1
}

# check the argument count
[[ $# -ne 1 ]] && usage_error "incorrect number of arguments"

action=${1}
case ${action} in
  start|stop|status) ;;
  *) usage_error "unrecognised action \"${action}\"" ;;
esac

# set the workspace root directory to the parent of the bin directory
SRC_ROOT_DIR="$(cd "$(dirname "${0}")/../."; pwd -P)"
# enable override if desired
export WORKSPACE_ROOT_DIR="${WORKSPACE_ROOT_DIR:-${SRC_ROOT_DIR}}"
echo "Using workspace: ${WORKSPACE_ROOT_DIR}"

case ${action} in
  start)
    docker-compose -f ${WORKSPACE_ROOT_DIR}/docker-compose.yml up -d
    ;;
  stop)
    docker-compose -f ${WORKSPACE_ROOT_DIR}/docker-compose.yml down
    ;;
  status)
    docker-compose -f ${WORKSPACE_ROOT_DIR}/docker-compose.yml ps
    ;;
  *)
    usage_error "how did I get here with action: \"${action}\""
esac
